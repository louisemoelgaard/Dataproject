---
title: "GWAS"
output: html_document
---

```{r}
library(bigsnpr)
library(dplyr)
```


```{r}
# Get information
G3 = snp_attach("test_fbm.rds")

```


```{r}
# Make regressions


G = G3$genotypes
y = G3$fam$y

lms = list(rep(0, iterations))

block_size = 10
iterations = M/block_size


GWAS = lapply(1:iterations, function(i) {
              current_start = (i-1) * block_size + 1
              current_end = current_start + block_size - 1
  
              G_current = data.frame(G[,current_start:current_end])
              lm_current = sapply(G_current, function(x)  summary(lm(y ~ x))$coefficients[2,1:4])
  

}) %>% do.call('cbind', .) %>% t(.) %>%  as_tibble(rownames = NA)

```


```{r}
# Bonferrari correction

alpha = 0.05
p = alpha/1000000
Causal_estimate = ifelse(GWAS[,4]<=p, 1, 0)

```





